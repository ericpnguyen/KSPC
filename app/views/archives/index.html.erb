<%= stylesheet_link_tag "archives/new" %>
<%= stylesheet_link_tag "archives/index" %>
<%- if admin_signed_in? %>
  <div class="row">
    <div class="col-md-6"></div>
    <div class="col-md-6 text-right">
      <%= button_to "New Archive Entry", new_archive_path,
        {class: 'btn btn-success', method: "get"} %>
    </div>
  </div>
<% end %>

<iframe src='http://goo.gl/AEt5Rm'
        width='100%'
        height='650'
        webkitallowfullscreen
        mozallowfullscreen
        allowfullscreen
        frameborder='0'>
</iframe>
<br>

<div id="searchBar"></div>
<%= form_tag(archives_path+'#searchBar', :method => "get", id: "search-form") do %>
<div class="container">
  <div class="row">
    <div class="col-md-12">
      <div class="input-group" id="adv-search">
        <%= text_field_tag :search, params[:search], placeholder: "Search Archives" , class: "form-control" %>
        <div class="input-group-btn">
          <div class="btn-group" role="group">
            <div class="dropdown dropdown-lg">
              <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span class="caret"></span></button>
              <div class="dropdown-menu dropdown-menu-right" role="menu">
                Search for:
                <label> <%= check_box_tag 'showImages' , 1, true %> Images </label>
                <label> <%= check_box_tag 'showAudio', 1, true%> Audio </label>
                <label> <%= check_box_tag 'showVideo', 1, true %> Video </label>
                <br>
                Sort By:
                <label> <%= radio_button_tag :sortMethod, 'none', :checked => true %> Relevance </label>
                <label> <%= radio_button_tag :sortMethod, 'sortTitle' %> Title </label>
                <label> <%= radio_button_tag :sortMethod, 'sortDate' %> Date </label>
                <label> <%= radio_button_tag :sortMethod, 'sortUploaded' %> Date Uploaded </label>
                <br>
                <label> <%= radio_button_tag :sortMethod, 'sortTitleZ' %> Title Z-A </label>
                <label> <%= radio_button_tag :sortMethod, 'sortDateOld' %> Date Old-New</label>
                <label> <%= radio_button_tag :sortMethod, 'sortUploadedOld' %> Date Uploaded Old-New </label>
              </div>
            </div>
          </div>
        </div>
        <%= submit_tag "Search" %>
      </div>
    </div>
  </div>
</div>
<% end %>

<%= form_tag(archives_path, :method => "get", id: "sort-title-form") do %>
<%= hidden_field_tag :sortMethod, "sortTitle" %>
<%= hidden_field_tag :search, params[:search] %>
<%= hidden_field_tag :showImages, params[:showImages] %>
<%= hidden_field_tag :showAudio, params[:showAudio] %>
<%= hidden_field_tag :showVideo, params[:showVideo] %>
<%= submit_tag "Sort By Title" %>
<% end %>

<%= form_tag(archives_path, :method => "get", id: "sort-uploaded-form") do %>
<%= hidden_field_tag :sortMethod, "sortUploaded" %>
<%= hidden_field_tag :search, params[:search] %>
<%= hidden_field_tag :showImages, params[:showImages] %>
<%= hidden_field_tag :showAudio, params[:showAudio] %>
<%= hidden_field_tag :showVideo, params[:showVideo] %>
<%= submit_tag "Sort By Uploaded Date" %>
<% end %>

<%= form_tag(archives_path, :method => "get", id: "sort-date-form") do %>
<%= hidden_field_tag :sortMethod, "sortDate" %>
<%= hidden_field_tag :search, params[:search] %>
<%= hidden_field_tag :showImages, params[:showImages] %>
<%= hidden_field_tag :showAudio, params[:showAudio] %>
<%= hidden_field_tag :showVideo, params[:showVideo] %>
<%= submit_tag "Sort By Date" %>
<% end %>

<% if @archives.blank? %>
  <h4>There are no archives containing the term <%= params[:search] %></h4>
<% end %>
<br>
<div class="row">
<% @archives.each_with_index do |archive, i| %>
  <div class="archive card text-center">
    <div class="thumbnails">
      <%=
        if admin_signed_in?
          button_to "Ã—", archive_path(archive),
            remote: true, 
            method: :delete,
            data: { confirm: "Delete this archive entry?" },
            class: "close delete-button"
        end
      %>
      <%=
        taglist = "<div class='tag-box'>"
        archive.tag_list.each do |tag|
          taglist += "<span class='tag'>" + tag + "</span>"
        end
        taglist += "</div>"
        if archive.media.content_type.start_with?("image")
          link_to image_tag(archive.media.url(:thumb)),
            archive.media.url,
            data: {
              toggle: "lightbox",
              title: archive.title,
              footer: "<div>
                        <div>" + archive.description + "</div>" +
                        taglist +
                      "</div>",
            }
        elsif archive.media.content_type.start_with?("audio")
          link_to image_tag("defaultImage.png"),
            "http://localhost:3000" + archive.media.url,
            data: {
              toggle: "lightbox",
              title: archive.title,
              footer: "<div>
                        <div>" + archive.description + "</div>" +
                        taglist +
                      "</div>",
              type: "video",
              audio: archive.media.url,
            },
            class: "block-context-menu"
        else
          link_to image_tag("defaultImage.png"),
            "http://localhost:3000" + archive.media.url,
            data: {
              toggle: "lightbox",
              title: archive.title,
              footer: "<div>
                        <div>" + archive.description + "</div>" +
                        taglist +
                      "</div>",
              type: "video",
            },
            class: "block-context-menu"
        end
      %>
      <h2><span><%= archive.title %></span>
        <br /><date><%= archive.date %></date></h2>
    </div>
  </div>
<% end %>
</div>

<!-- Render page links -->
<%= will_paginate @posts %>

<br>
